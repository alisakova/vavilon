var accordion = document.querySelectorAll('.accordion');

for (var i = 0; i < accordion.length; i++) {
  accordion[i].addEventListener('click', function() {
    this.classList.toggle('active');
    var panel = this.nextElementSibling; //ищет последующий элемент после текущего
    if (panel.style.maxHeight) {
      panel.style.maxHeight = null;
    } else {
      panel.style.maxHeight = panel.scrollHeight + 'px';
    }
  });
}

var mobileShowBtn = document.querySelectorAll(".mobile-show-btn");
var wrapTextSizes = {
  "wrap-text index-text": "333px",
  "wrap-text descr-text": "178px",
  "wrap-text equip-text": "222px",
  "wrap-text support-text": "311px",
  "wrap-text news-text": "178px",
  "wrap-text company-text": "444px",
  "wrap-text working-text": "378px",
  "wrap-text reviews-text": "466px",
  "wrap-text product-text": "134px",
}

mobileShowBtn.forEach(function(btn) {
  btn.addEventListener("click", function() {
    var wrapText = btn.previousSibling;
    console.log(wrapText);
    if (wrapText.classList.contains('expanded')) {
      wrapText.classList.remove('expanded');
      var addClass = wrapText.classList;
      console.log(addClass.value);
      var maxHeightText = wrapTextSizes[addClass];
      console.log(maxHeightText);
      wrapText.style.maxHeight = maxHeightText;
      btn.innerHTML = 'Показать полностью';
    } else {
      wrapText.classList.add('expanded');
      wrapText.style.maxHeight = wrapText.scrollHeight + 'px';
      btn.innerHTML = 'Скрыть';
    }
  })

});

$(".form__input").on("blur", function() {
  if ($(this).val().length) {
    $(this).addClass("not-empty");
  } else {
    $(this).removeClass("not-empty");
  }
});

var dataTabs = document.querySelectorAll(".data-tabs__tab");

dataTabs.forEach(function(tab) {
  if (window.innerWidth < 600) {
    tab.classList.add("accordion");
    tab.classList.remove("_tabs-tab");
  }
});

var openMenu = document.querySelector('._open-menu');
var closeMenu = document.querySelector('._close-menu');
var menu = document.querySelector('._menu');
var subMenu = document.querySelector('._submenu');
var closeSubMenu = document.querySelector('._close-submenu');
var openSubMenu = document.querySelector('.heading__mobile-link');
if (menu) {
  openMenu.addEventListener('click', function(e) {
    e.stopPropagation();
    menu.classList.add('active');
  });

  closeMenu.addEventListener('click', function(e) {
    e.stopPropagation();
    menu.classList.remove('active');
  });
}

if (subMenu) {
  openSubMenu.addEventListener('click', function(e) {
    e.stopPropagation();
    subMenu.classList.add('active');
  });

  closeSubMenu.addEventListener('click', function(e) {
    e.stopPropagation();
    subMenu.classList.remove('active');
  });
}

var openSuccessModalBtn = document.querySelector(".modal#leasing .btn");

if (openSuccessModalBtn) {
  openSuccessModalBtn.addEventListener("click", function(e) {
    var instance = $.fancybox.getInstance();
    e.preventDefault();
    if (instance) {
      instance.close();
      $.fancybox.open({
        src  : '#success-modal',
        type : 'inline'
      });
    }
  })
}

//для плавного скролла к якорям
$(document).ready(function() {
  $("body").on("click", "._scroll-btn", function(event) {
    event.preventDefault();
    var id = $(this).attr("href"),
        top = $(id).offset().top;
    $("body,html").animate({ scrollTop: top }, 1500);
  });
});

$(document).ready(function() {
    $('.filter__select').select2({
      minimumResultsForSearch: Infinity,
      width: 'resolve'
    });
    $('.form__select').select2({
      minimumResultsForSearch: Infinity,
      dropdownParent: $('.form')
    });
});

$(document).ready(function() {
  if ($("._slider").length) {
    $("._slider").slick({
      infinite: true,
      speed: 500,
      // autoplay: true,
      autoplaySpeed: 15000,
      fade: true,
      arrows: false,
      dots: true,
    });
  }
  if ($(".companies-slider").length) {
    $(".companies-slider").slick({
      slidesToShow: 5,
      infinite: true,
      responsive: [
        {
          breakpoint: 992,
          settings: {
            slidesToShow: 4
          }
        },
        {
          breakpoint: 700,
          settings: {
            slidesToShow: 2
          }
        }
      ]
      // adaptiveHeight: true
    });
  }
});

function openTab(evt, name) {
  var i, tabcontent, tablinks;

  tabcontent = document.getElementsByClassName("_tabs-content");
  for (i = 0; i < tabcontent.length; i++) {
    tabcontent[i].style.display = "none";
  }

  tablinks = document.getElementsByClassName("_tabs-tab");
  for (i = 0; i < tablinks.length; i++) {
    tablinks[i].className = tablinks[i].className.replace(" active", "");
  }

  document.getElementById(name).style.display = "block";
  evt.currentTarget.className += " active";
}

var defaultClick = document.querySelector("._default");

if (defaultClick) {
  defaultClick.click();
}

var toTopBtn = document.querySelector(".top-btn");
var scrollAnimation;

if (toTopBtn) {
  window.onscroll = function() {
    scrollFunction();
  };

  function scrollFunction() {
    if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
      toTopBtn.classList.add("active");
    } else {
      toTopBtn.classList.remove("active");
    }
  }

  function scrollToTop() {
    var position = document.body.scrollTop || document.documentElement.scrollTop;
    if (position) {
      window.scrollBy(0, -Math.max(10, Math.floor(position / 10)));
      scrollAnimation = setTimeout("scrollToTop()", 10);
    } else clearTimeout(scrollAnimation);
  }
}
