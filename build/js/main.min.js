var accordion = document.querySelectorAll('.accordion');

for (var i = 0; i < accordion.length; i++) {
  accordion[i].addEventListener('click', function() {
    this.classList.toggle('active');
    var panel = this.nextElementSibling; //ищет последующий элемент после текущего
    if (panel.style.maxHeight) {
      panel.style.maxHeight = null;
    } else {
      panel.style.maxHeight = panel.scrollHeight + 'px';
    }
  });
}

var mobileShowBtn = document.querySelectorAll(".mobile-show-btn");
var wrapTextSizes = {
  "wrap-text index-text": "333px",
  "wrap-text descr-text": "178px",
  "wrap-text equip-text": "222px",
  "wrap-text support-text": "311px",
  "wrap-text news-text": "178px",
  "wrap-text company-text": "444px",
  "wrap-text working-text": "378px",
  "wrap-text reviews-text": "466px",
  "wrap-text product-text": "134px",
}

mobileShowBtn.forEach(function(btn) {
  btn.addEventListener("click", function() {
    var wrapText = btn.previousSibling;
    console.log(wrapText);
    if (wrapText.classList.contains('expanded')) {
      wrapText.classList.remove('expanded');
      var addClass = wrapText.classList;
      console.log(addClass.value);
      var maxHeightText = wrapTextSizes[addClass];
      console.log(maxHeightText);
      wrapText.style.maxHeight = maxHeightText;
      btn.innerHTML = 'Показать полностью';
    } else {
      wrapText.classList.add('expanded');
      wrapText.style.maxHeight = wrapText.scrollHeight + 'px';
      btn.innerHTML = 'Скрыть';
    }
  })

});

$(".form__input").on("blur", function() {
  if ($(this).val().length) {
    $(this).addClass("not-empty");
  } else {
    $(this).removeClass("not-empty");
  }
});

var dataTabs = document.querySelector(".data-tabs");
var tabs = document.querySelector(".tabs");
var dataTabsTab = document.querySelectorAll('.data-tabs .data-tabs__tab');
var dataTabsContent = document.querySelectorAll('.data-tabs .data-tabs__content');
var dataTabsContainer = document.querySelector('.data-tabs__container');
var tabsTab = document.querySelectorAll('.tabs .tabs__tab');
var tabsContent = document.querySelectorAll('.tabs .tabs__content');
var tabsContainer = document.querySelector('.tabs__container');
var eventFired = 0;

window.onresize = function() {
  if (window.innerWidth < 700 && !eventFired) {
    eventFired = 1;
    if (tabs) {
      changeTabs();
    }
    if (dataTabs) {
      changeDataTabs();
    }
  }
  if (window.innerWidth >= 700) {
    eventFired = 0;
    if (tabs) {
      if (!tabs.classList.contains('_tabs')) {
        initTabs();
      }
    }

    if (dataTabs) {
      if (!dataTabs.classList.contains('_tabs')) {
        initDataTabs();
      }
    }
  }
}

if (window.innerWidth < 700) {
  if (tabs) {
    changeTabs();
    eventFired = 1;
  }
  if (dataTabs) {
    changeDataTabs();
    eventFired = 1;
  }
}

function initTabs() {
  tabs.classList.add("_tabs");
  tabsTab.forEach(function(tab) {
    tab.classList.add('_tabs-tab');
    tab.onclick = function() {
      return true;
    }
  })
  var tabsContentNew = document.querySelectorAll('._tabs .tabs__container .tabs__content');
  tabsContentNew.forEach(function(content, index2) {
    var newContent = content.cloneNode(true);
    var parent = content.parentNode;
    tabsContainer.removeChild(content);
    newContent.classList.add('_tabs-content');
    newContent.classList.remove('panel');
    if (index2 <= 5) {
      tabs.appendChild(newContent);
    }
  })
}

function initDataTabs() {
  dataTabs.classList.add("_tabs");
  dataTabsTab.forEach(function(tab) {
    tab.classList.add('_tabs-tab');
    tab.onclick = function() {
      return true;
    }
  })
  dataTabsContent.forEach(function(content, index2) {
    var newContent = content.cloneNode(true);
    var parent = content.parentNode;
    parent.removeChild(content);
    newContent.classList.add('_tabs-content');
    newContent.classList.remove('panel');
    if (index2 <= 5) {
      dataTabs.appendChild(newContent);
    }
  })
}

function changeDataTabs() {
  console.log('changedataTabs');
  if (dataTabs) {
    dataTabs.classList.remove("_tabs");
    dataTabsTab.forEach(function(tab, index) {
      if (tab.classList.contains("_default")) {
        tab.classList.remove("_default");
      }
      tab.classList.add("accordion");
      tab.classList.remove("_tabs-tab");
      tab.onclick = function() {
        return false;
      }
      tab.addEventListener("click", function(e) {
        this.classList.toggle('active');
        var panel = this.nextElementSibling;
        if (panel.style.maxHeight) {
          panel.style.maxHeight = null;
        } else {
          panel.style.maxHeight = panel.scrollHeight + 'px';
        }
      })
    });
    dataTabsContent.forEach(function(content, index2) {
      var newContent = content.cloneNode(true);
      var parent = content.parentNode;
      parent.removeChild(content);
      newContent.classList.add('panel');
      newContent.classList.remove('_tabs-content');
      if (index2 <= 3) {
        dataTabsContainer.insertBefore(newContent, dataTabsTab[index2].nextSibling);
      }
    })
  }
}

function changeTabs() {
  if (tabs) {
    tabs.classList.remove("_tabs");
    tabsTab.forEach(function(tab, index) {
      if (tab.classList.contains("_default")) {
        tab.classList.remove("_default");
      }
      tab.classList.remove("_tabs-tab");
      tab.onclick = function() {
        return false;
      }
    });
    tabsContent.forEach(function(content, index2) {
      var newContent = content.cloneNode(true);
      var parent = content.parentNode;
      console.log(parent);
      parent.removeChild(content);
      newContent.classList.remove('_tabs-content');
      if (index2 <= 5) {
        tabsContainer.insertBefore(newContent, tabsTab[index2].nextSibling);
      }
    })
  }
}

var openMenu = document.querySelector('._open-menu');
var closeMenu = document.querySelector('._close-menu');
var menu = document.querySelector('._menu');
var subMenu = document.querySelector('._submenu');
var closeSubMenu = document.querySelector('._close-submenu');
var openSubMenu = document.querySelector('.heading__mobile-link');
if (menu) {
  openMenu.addEventListener('click', function(e) {
    e.stopPropagation();
    menu.classList.add('active');
  });

  closeMenu.addEventListener('click', function(e) {
    e.stopPropagation();
    menu.classList.remove('active');
  });
}

if (subMenu) {
  openSubMenu.addEventListener('click', function(e) {
    e.stopPropagation();
    subMenu.classList.add('active');
  });

  closeSubMenu.addEventListener('click', function(e) {
    e.stopPropagation();
    subMenu.classList.remove('active');
  });
}

var openSuccessModalBtn = document.querySelectorAll(".modal ._open-success");

if (openSuccessModalBtn) {
  openSuccessModalBtn.forEach(function(btn) {
    btn.addEventListener("click", function(e) {
      var instance = $.fancybox.getInstance();
      e.preventDefault();
      if (instance) {
        instance.close();
        $.fancybox.open({
          src  : '#success-modal',
          type : 'inline'
        });
      }
    })
  })

}

var makeOrderBtn = document.querySelector(".modal .basket__mobile-btn");

if (makeOrderBtn) {
  makeOrderBtn.addEventListener("click", function(e) {
    var instance = $.fancybox.getInstance();
    e.preventDefault();
    if (instance) {
      instance.close();
      $.fancybox.open({
        src  : '#make-order',
        type : 'inline'
      });
    }
  })
}

var mainProductCard = document.querySelector(".product-card__img img");
var imgPreviews = document.querySelectorAll(".product-card__img-preview");

if (mainProductCard) {
  imgPreviews.forEach(function(preview) {
    preview.addEventListener("click", function() {
      removeClass(imgPreviews);
      preview.classList.add("active");
      var img = preview.querySelector("img");
      mainProductCard.src = img.src;
    });
  })
}

function removeClass(array) {
  array.forEach(function(item) {
    if (item.classList.contains("active")) {
      item.classList.remove("active");
    }
  })
}

//для плавного скролла к якорям
$(document).ready(function() {
  $("body").on("click", "._scroll-btn", function(event) {
    event.preventDefault();
    var id = $(this).attr("href"),
        top = $(id).offset().top;
    $("body,html").animate({ scrollTop: top }, 1500);
  });
});

$(document).ready(function() {
    $('.filter__select').select2({
      minimumResultsForSearch: Infinity,
      width: 'resolve'
    });
    $('.form__select').select2({
      minimumResultsForSearch: Infinity,
      dropdownParent: $('.form')
    });
});

$(document).ready(function() {
  if ($("._slider").length) {
    $("._slider").slick({
      infinite: true,
      speed: 500,
      // autoplay: true,
      autoplaySpeed: 15000,
      fade: true,
      arrows: false,
      dots: true,
    });
  }
  if ($(".companies-slider").length) {
    $(".companies-slider").slick({
      slidesToShow: 5,
      infinite: true,
      responsive: [
        {
          breakpoint: 992,
          settings: {
            slidesToShow: 4
          }
        },
        {
          breakpoint: 700,
          settings: {
            slidesToShow: 2
          }
        }
      ]
      // adaptiveHeight: true
    });
  }
});

function openTab(evt, name) {
  var i, tabcontent, tablinks;

  tabcontent = document.getElementsByClassName("_tabs-content");
  for (i = 0; i < tabcontent.length; i++) {
    tabcontent[i].style.display = "none";
  }

  tablinks = document.getElementsByClassName("_tabs-tab");
  for (i = 0; i < tablinks.length; i++) {
    tablinks[i].className = tablinks[i].className.replace(" active", "");
  }

  document.getElementById(name).style.display = "block";
  evt.currentTarget.className += " active";
}

var defaultClick = document.querySelector("._default");

if (defaultClick) {
  defaultClick.click();
}

var toTopBtn = document.querySelector(".top-btn");
var scrollAnimation;

if (toTopBtn) {
  window.onscroll = function() {
    scrollFunction();
  };

  function scrollFunction() {
    if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
      toTopBtn.classList.add("active");
    } else {
      toTopBtn.classList.remove("active");
    }
  }

  function scrollToTop() {
    var position = document.body.scrollTop || document.documentElement.scrollTop;
    if (position) {
      window.scrollBy(0, -Math.max(10, Math.floor(position / 10)));
      scrollAnimation = setTimeout("scrollToTop()", 10);
    } else clearTimeout(scrollAnimation);
  }
}
